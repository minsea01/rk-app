# 第一章 绪论

## 1.1 研究背景与意义

### 1.1.1 研究背景

随着人工智能技术的飞速发展，深度学习在计算机视觉领域取得了突破性进展。目标检测作为计算机视觉的核心任务之一，在智能监控、自动驾驶、人机交互等领域有着广泛的应用前景。特别是行人检测技术，作为智能安防、智慧交通、零售分析等场景的关键环节，其研究具有重要的理论价值和实际意义。

传统的行人检测系统通常采用云端部署方式，将视频流传输至云端服务器进行处理。然而，这种方案存在以下问题：

1. **网络带宽压力大**：高清视频流的实时传输需要稳定的高带宽网络
2. **延迟不可控**：网络抖动导致检测结果延迟不稳定
3. **隐私安全隐患**：视频数据上传至云端存在隐私泄露风险
4. **成本高昂**：云服务费用和带宽费用持续增加

边缘计算的兴起为解决上述问题提供了新的思路。通过将计算任务下沉到边缘设备，可以实现本地化的实时推理，降低网络带宽需求，保护用户隐私，并降低长期运营成本。Rockchip RK3588作为新一代边缘AI处理器，集成了高性能NPU（Neural Processing Unit），为深度学习模型的边缘部署提供了硬件基础。

### 1.1.2 研究意义

**理论意义：**

1. 探索深度学习模型在资源受限边缘设备上的优化部署方法
2. 研究INT8量化对YOLO系列模型精度和性能的影响
3. 验证NPU硬件加速在实时目标检测中的效果
4. 建立端到端的边缘AI系统设计方法论

**实际意义：**

1. **降低部署成本**：边缘推理无需云端服务器，减少硬件投入和运营费用
2. **提升实时性**：本地推理延迟可控，满足实时应用需求
3. **增强隐私保护**：视频数据不出设备，符合数据安全法规要求
4. **提高系统可靠性**：不依赖网络连接，在网络不稳定环境也能稳定运行
5. **工程实践价值**：提供可复用的模型转换、部署、测试完整工具链

---

## 1.2 国内外研究现状

### 1.2.1 目标检测算法研究现状

**YOLO系列算法演进：**

目标检测算法经历了从两阶段检测器（R-CNN系列）到单阶段检测器（YOLO、SSD系列）的演变。YOLO（You Only Look Once）系列因其速度快、精度高的特点，成为实时目标检测的主流方案。

| 模型 | 发布时间 | 主要创新 | 性能（COCO） |
|------|---------|---------|------------|
| YOLOv3 | 2018 | 多尺度预测、残差网络 | mAP 33.0% |
| YOLOv5 | 2020 | 自适应锚框、CSPNet | mAP 48.2% |
| YOLOv8 | 2023 | Anchor-free、C2f模块 | mAP 52.9% |
| YOLO11 | 2024 | C3k2模块、SPPF改进 | mAP 54.7% |

本设计选用**YOLO11n**（nano版本）作为基础模型，原因如下：

1. **轻量化设计**：参数量小（2.6M），适合边缘设备
2. **实时性能优异**：在保证精度的前提下达到30+ FPS
3. **易于优化**：支持ONNX导出和INT8量化
4. **生态成熟**：Ultralytics框架提供完整工具链

### 1.2.2 模型量化与压缩研究

**量化技术分类：**

1. **训练后量化（Post-Training Quantization, PTQ）**：
   - 无需重新训练，直接量化已训练模型
   - 使用校准数据集计算激活值分布
   - 本设计采用的方案，工程实用性强

2. **量化感知训练（Quantization-Aware Training, QAT）**：
   - 在训练过程中模拟量化误差
   - 精度损失更小，但需要重新训练
   - 训练成本高，不适合快速迭代

**INT8量化原理：**

INT8量化将FP32浮点权重和激活值映射到INT8整数范围（-128~127），实现以下优势：

1. **模型体积压缩**：理论上压缩至原来的1/4
2. **计算速度提升**：整数运算效率远高于浮点
3. **内存占用减少**：降低推理时的内存峰值

量化公式：
```
q = round(r / S) + Z
```
其中：
- r：实际浮点值
- S：缩放因子（scale）
- Z：零点偏移（zero point）
- q：量化后的整数值

### 1.2.3 边缘AI芯片研究

**Rockchip RK3588特性：**

RK3588是Rockchip于2022年推出的高性能边缘AI SoC，主要特性：

| 组件 | 规格 | 说明 |
|------|------|------|
| CPU | 4×A76@2.4GHz + 4×A55@1.8GHz | 大小核异构 |
| NPU | 3核心，6 TOPS INT8 | 支持INT8/INT16/FP16 |
| GPU | Mali-G610 MP4 | OpenGL ES 3.2, Vulkan 1.2 |
| 内存 | LPDDR4/LPDDR5，最高32GB | 本设计采用16GB |
| 视频 | 8K@60fps编解码 | H.265/H.264/VP9 |
| 接口 | 双千兆网口（RGMII） | 本设计核心功能 |

**NPU支持的框架：**

1. **RKNN-Toolkit2**：Rockchip官方工具，支持：
   - TensorFlow / TensorFlow Lite
   - PyTorch（通过ONNX）
   - Caffe
   - ONNX（直接支持）

2. **优化特性**：
   - 算子融合（Operator Fusion）
   - 内存优化（Memory Optimization）
   - 多核并行（Multi-core Parallel）

### 1.2.4 双网口行人检测系统研究

**工业应用场景：**

双网口配置在工业视觉系统中应用广泛：

1. **网口1（数据采集）**：连接GigE工业相机
   - 实时采集1080P@30fps视频流
   - 带宽需求：约150 Mbps（JPEG压缩）

2. **网口2（结果输出）**：上传检测结果
   - 传输JSON格式检测框信息
   - 带宽需求：约0.5 Mbps（轻量级）

**现有研究不足：**

1. **缺乏端到端方案**：大多研究聚焦于模型优化，缺少完整系统设计
2. **双网口驱动复杂**：RGMII接口配置涉及底层驱动，文档不足
3. **量化精度损失**：INT8量化后mAP下降需要系统性分析
4. **工程化程度低**：缺乏可复用的工具链和自动化脚本

---

## 1.3 本文主要工作

本设计完成了从模型训练到边缘部署的完整工作流，具体包括：

### 1.3.1 系统设计与实现

1. **硬件系统设计**：
   - RK3588核心板选型与配置
   - 双千兆网口RGMII接口设计
   - 电源与散热方案设计

2. **软件架构设计**：
   - Ubuntu 22.04系统移植与优化
   - 双网卡驱动适配与性能调优
   - Python推理框架设计（主方案）
   - C++高性能部署方案（备选）

### 1.3.2 模型优化与转换

1. **模型选型与训练**：
   - 选用YOLO11n作为基础模型
   - 在COCO数据集上验证性能
   - 探索不同输入分辨率（416×416 vs 640×640）

2. **模型转换工具链**：
   - PyTorch → ONNX 转换（使用Ultralytics）
   - ONNX → RKNN 转换（使用rknn-toolkit2）
   - INT8量化配置与校准数据集准备

3. **精度与性能分析**：
   - ONNX vs RKNN推理结果对比
   - 量化前后精度损失评估
   - PC模拟器 vs 板端实际性能对比

### 1.3.3 部署与测试

1. **部署方案设计**：
   - Python RKNNLite推理框架
   - 预处理模块（图像缩放、格式转换）
   - 后处理模块（NMS、置信度过滤）
   - 网络传输模块（JSON序列化、TCP/UDP）

2. **性能优化**：
   - 参数调优（conf=0.5，避免NMS瓶颈）
   - 分辨率优化（416×416避免Transpose CPU回退）
   - 多核NPU并行推理

3. **系统测试**：
   - 单元测试（40+测试用例，覆盖率88-100%）
   - 集成测试（端到端推理流程）
   - 性能基准测试（MCP管道）

### 1.3.4 工程化与自动化

1. **工具链开发**：
   - 模型转换脚本（`export_yolov8_to_onnx.py`, `convert_onnx_to_rknn.py`）
   - 部署脚本（`rk3588_run.sh`, `deploy_to_board.sh`）
   - 性能测试脚本（`run_bench.sh`, `compare_onnx_rknn.py`）

2. **Claude Code自动化**：
   - 5个Slash Commands（/full-pipeline, /thesis-report等）
   - 完整的CI/CD友好脚本

3. **文档体系**：
   - 技术文档（21个Markdown文件）
   - 开题报告与毕业论文（本文）
   - API文档与使用指南

---

## 1.4 论文的创新点

本设计的主要创新点包括：

### 1.4.1 端到端边缘部署方案

**创新内容**：

1. **Boardless开发流程**：
   - 无需硬件即可完成80%的开发工作
   - PC模拟器验证模型功能性
   - 提前发现问题，减少板端调试时间

2. **双阶段部署策略**：
   - 主方案：Python RKNNLite（灵活、易维护）
   - 备选方案：C++二进制（性能优先）
   - 根据实际需求选择部署方式

**对比现有方案**：

传统方案需要先拿到硬件才能开始开发，本设计通过PC模拟器实现了无硬件开发，大幅缩短项目周期。

### 1.4.2 Transpose算子NPU适配分析

**创新内容**：

发现并解决了RKNN NPU的Transpose算子限制问题：

1. **问题分析**：
   - RKNN NPU的Transpose操作限制为16384个元素
   - 640×640输入导致输出张量(1, 84, 8400)超限（4×8400=33600）
   - 超限后CPU回退，性能下降10倍

2. **解决方案**：
   - 采用416×416输入分辨率
   - 输出张量(1, 84, 3549)满足NPU限制（4×3549=14196）
   - 完全NPU执行，无CPU回退

**工程价值**：

该发现对所有RK3588上部署YOLO模型的开发者有参考价值，可避免性能陷阱。

### 1.4.3 参数调优与性能分析

**创新内容**：

系统性分析了YOLO推理参数对性能的影响：

| 参数配置 | 后处理延迟 | FPS | 说明 |
|---------|-----------|-----|------|
| conf=0.25（默认） | 3135ms | 0.3 | NMS瓶颈 |
| conf=0.5（优化） | 5.2ms | 60+ | 生产可用 |

**分析结论**：

1. 低置信度阈值导致大量候选框，NMS成为瓶颈
2. 工业应用应使用conf≥0.5，牺牲少量召回率换取实时性
3. 参数调优比模型优化更直接、更有效

### 1.4.4 完整工程化工具链

**创新内容**：

开发了覆盖全生命周期的自动化工具链：

1. **模型转换**：一键式PyTorch→ONNX→RKNN转换
2. **验证测试**：PC模拟器 + 精度对比 + 性能测试
3. **部署自动化**：SSH部署 + 一键运行 + 远程调试
4. **质量保证**：40+单元测试 + pre-commit hooks

**工程价值**：

该工具链可直接用于其他RK3588项目，具有高度可复用性。

---

## 1.5 论文组织结构

本论文共分七章，各章节内容安排如下：

**第一章 绪论**：介绍研究背景、意义、国内外研究现状、主要工作、创新点和论文结构。

**第二章 系统设计与架构**：阐述系统总体设计、硬件平台选型、软件架构设计、网络接口配置等内容。

**第三章 模型优化与转换**：详细介绍YOLO11n模型选型、ONNX导出、INT8量化、RKNN转换的完整流程。

**第四章 部署策略与实现**：讨论部署方案选择、Python推理框架实现、预处理与后处理模块设计、网络传输集成。

**第五章 性能测试与分析**：给出PC基准测试、RKNN模拟器验证、参数调优分析、毕业要求符合性验证。

**第六章 系统集成与验证**：（待硬件后补充）展示板端实际测试结果、双网口性能验证、端到端延迟分析。

**第七章 总结与展望**：总结本设计的主要工作和创新点，分析存在的不足，展望未来改进方向。

---

**本章小结**：

本章介绍了基于RK3588的行人检测系统的研究背景、意义和现状，阐述了本文的主要工作和创新点。通过对国内外研究现状的分析，明确了本设计的技术路线和研究价值。接下来各章将详细介绍系统设计、模型优化、部署实现、性能测试等具体内容。
